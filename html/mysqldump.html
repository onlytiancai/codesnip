<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MySQL Dump Web</title>
    <link href="static/lib/bootstrap-5.3.3/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="static/lib/bootstrap-icons-1.11.3/font/bootstrap-icons.css">
    <link rel="stylesheet" href="static/lib/use-bootstrap-tag/use-bootstrap-tag.min.css">
</head>

<body>
    <div id="app">
        <div class="container mt-4">
            <h2 class="mb-4">MySQL Dump Web</h2>
            <ul class="nav nav-underline mb-2" role="tablist">
                <li class="nav-item" role="presentation">
                    <a id="tab-local-backup" class="nav-link active" data-bs-toggle="tab"
                        data-bs-target="#pane-local-backup" type="button" role="tab" aria-controls="pane-local-backup"
                        aria-selected="true">1. Local Backup</a>
                </li>
                <li class="nav-item" role="presentation">
                    <a id="tab-schedule" class="nav-link " data-bs-toggle="tab" data-bs-target="#pane-schedule"
                        type="button" role="tab" aria-controls="pane-schedule" aria-selected="false">2. Schedule</a>
                </li>
                <li class="nav-item" role="presentation">
                    <a id="tab-remote-backup" class="nav-link " data-bs-toggle="tab"
                        data-bs-target="#pane-remote-backup" type="button" role="tab" aria-controls="pane-remote-backup"
                        aria-selected="false">3. Remote Backup </a>
                </li>
                <li class="nav-item" role="presentation">
                    <a id="tab-notification" class="nav-link " data-bs-toggle="tab" data-bs-target="#pane-notification"
                        type="button" role="tab" aria-controls="pane-notification" aria-selected="false">4. Notification
                    </a>
                </li>
            </ul>
            <div class="tab-content">
                <div id="pane-local-backup" class="tab-pane fade show active" role="tabpanel"
                    aria-labelledby="tab-local-backup" tabindex="0">
                    <form id="mysqldump-form" ref="form">

                        <div class="card mb-3">
                            <div class="card-header">
                                Server Setting
                            </div>
                            <div class="card-body">
                                <div class="row g-2">
                                    <div class="col-md-6 form-check form-switch mt-2">
                                        <label class="form-check-label">Use config file
                                            <input class="form-check-input" type="checkbox" v-model="useEnv">
                                        </label>
                                        <i class="bi bi-question-circle ms-2" tabindex="0" data-bs-trigger="hover focus"
                                            data-bs-title="Help" data-bs-toggle="popover"
                                            data-bs-content="If you don't want to enter sensitive information such as passwords, you can use config file."></i>
                                    </div>
                                </div>
                                <div class="row g-2 mt-2" v-if="useEnv">
                                    <div class="col-md-4">
                                        <label class="form-label">Config file path
                                            <input type="text" class="form-control" v-model="confFilePath" required>
                                        </label>
                                    </div>
                                    <div class="alert alert-info mt-2" role="alert">
                                        Create the <code>{{confFilePath}}</code> file with the following contents and
                                        modify it as needed.
                                        <pre class="bg-light p-3 border rounded">{{dbConfExample}}</pre>
                                    </div>
                                </div>

                                <div class="row g-2 mt-2" v-if="!useEnv">
                                    <div class="col-md-3">
                                        <label class="form-label">Host
                                            <input type="text" class="form-control" v-model="host"
                                                placeholder="localhost" required></label>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">User
                                            <input type="text" class="form-control" v-model="user" placeholder="root"
                                                required></label>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">Password
                                            <input type="password" class="form-control" v-model="password">
                                        </label>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">Port<input type="number" class="form-control"
                                                v-model="port" placeholder="3306"></label>
                                    </div>
                                </div>

                            </div>
                        </div>

                        <div class="card mb-3">
                            <div class="card-header">
                                Database/Table Setting
                            </div>
                            <div class="card-body">
                                <div class="row g-2">
                                    <div class="col-md-6 form-check form-switch mt-4">
                                        <label class="form-check-label">All Databases
                                            <input class="form-check-input" type="checkbox" v-model="allDatabases">
                                        </label>
                                    </div>
                                </div>
                                <div class="row g-2 mt-2" v-if="!allDatabases">
                                    <div class="col-md-4">
                                        <label for="database" class="form-label">Database</label>
                                        <input type="text" class="form-control" v-model="database"
                                            placeholder="Database name" required>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="table" class="form-label">Tables</label>
                                        <input type="text" class="form-control" placeholder="Table name"
                                            @change="tableChange" ref="tables">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="card mb-3">
                            <div class="card-header">
                                Common Parameters
                            </div>
                            <div class="card-body">
                                <div class="row g-2">
                                    <div class="col-md-4">
                                        <label for="outputFile" class="form-label">Backup directory</label>
                                        <input type="text" class="form-control" v-model="outputFile"
                                            placeholder="/data/mysql-backup" required>
                                    </div>
                                    <div class="col-md-8">
                                        <label  class="form-label">Other args</label>
                                        <input type="text" class="form-control" v-model="otherArgs" >
                                    </div>
                                </div>
                                <div class="row g-2">
                                    <div class="col-md-6 form-check form-switch mt-4">
                                        <label class="form-check-label">Add DROP DATABASE
                                            <input class="form-check-input" type="checkbox" v-model="addDropDatabase">
                                        </label>
                                        <i class="bi bi-question-circle ms-2" tabindex="0" data-bs-trigger="hover focus"
                                            data-bs-title="Help" data-bs-toggle="popover"
                                            data-bs-content="Add a DROP DATABASE before each create."></i>
                                    </div>
                                    <div class="col-md-6 form-check form-switch mt-4">

                                        <label class="form-check-label">Skip Add DROP TABLE<input class="form-check-input"
                                                type="checkbox" v-model="skipAddDropTable"></label>
                                        <i class="bi bi-question-circle ms-2" tabindex="0" data-bs-html="true"
                                            data-bs-trigger="hover focus" data-bs-title="Help" data-bs-toggle="popover"
                                            data-bs-content="Add a DROP TABLE before each create. <br>(Defaults to on; use --skip-add-drop-table to disable.)"></i>
                                    </div>
                                </div>
                                <div class="row g-2 mt-2">
                                    <div class="col-md-6 form-check form-switch">

                                        <label class="form-check-label">Include Stored Procedures &
                                            Functions<input class="form-check-input" type="checkbox"
                                                v-model="routines"></label>
                                    </div>
                                    <div class="col-md-6 form-check form-switch">

                                        <label class="form-check-label">Include Triggers<input class="form-check-input"
                                                type="checkbox" v-model="triggers"></label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Advanced Parameters (Collapsible) -->
                        <div class="card mb-3">
                            <div class="card-header">
                                <button class="btn btn-link p-0" type="button" data-bs-toggle="collapse"
                                    data-bs-target="#advancedParameters" aria-expanded="false"
                                    aria-controls="advancedParameters">
                                    Advanced Parameters
                                </button>
                            </div>
                            <div id="advancedParameters" class="collapse">
                                <div class="card-body">
                                    <div class="row g-2">
                                        <div class="col-md-3">
                                            <label class="form-label">Compression Level<input type="number"
                                                    class="form-control" v-model="compress" placeholder="1-9"></label>

                                        </div>
                                        <div class="col-md-3">
                                            <label class="form-label">Master Data
                                                <i class="bi bi-question-circle ms-2" tabindex="0" data-bs-html="true"
                                                    data-bs-trigger="hover focus" data-bs-title="Help"
                                                    data-bs-toggle="popover"
                                                    data-bs-content="This causes the binary log position and filename to be appended to the output. If equal to 1, will print it as a   CHANGE MASTER command; if equal to 2, that ommand will  be prefixed with a comment symbol. This option will turn  --lock-all-tables on, unless --single-transaction is  specified too (in which case a global ead lock is only  taken a short time at the beginning of the dump; don't  forget to read about --single-transaction below). In all  cases, any action on logs will happen at the exact moment  of the dump. Option automatically turns --lock-tables  off."></i>
                                                <input type="number" class="form-control" v-model="masterData"
                                                    placeholder="1 or 2"></label>

                                        </div>
                                    </div>
                                    <div class="row g-2 mt-2">
                                        <div class="col-md-3 form-check form-switch">

                                            <label class="form-check-label">Lock
                                                Tables<input class="form-check-input" type="checkbox"
                                                    v-model="lockTables"></label>
                                            <i class="bi bi-question-circle ms-2" tabindex="0" data-bs-html="true"
                                                data-bs-trigger="hover focus" data-bs-title="Help"
                                                data-bs-toggle="popover"
                                                data-bs-content="Lock all tables for read.\n(Defaults to on; use --skip-lock-tables to disable.)"></i>
                                        </div>
                                        <div class="col-md-3 form-check form-switch">

                                            <label class="form-check-label">No Data (Schema Only)<input
                                                    class="form-check-input" type="checkbox" v-model="noData"></label>

                                        </div>
                                        <div class="col-md-3 form-check form-switch">

                                            <label class="form-check-label">Single
                                                Transaction<input class="form-check-input" type="checkbox"
                                                    v-model="singleTransaction"></label>
                                            <i class="bi bi-question-circle ms-2" tabindex="0" data-bs-html="true"
                                                data-bs-trigger="hover focus" data-bs-title="Help"
                                                data-bs-toggle="popover"
                                                data-bs-content="Creates a consistent snapshot by dumping all tables in a<br>single transaction. Works ONLY for tables stored in<br>storage engines which support multiversioning (currently<br>only InnoDB does); the dump is NOT guaranteed to be<br>consistent for other storage engines. While a<br>--single-transaction dump is in process, to ensure a<br>valid dump file (correct table contents and binary log<br>position), no other connection should use the following<br>statements: ALTER TABLE, DROP TABLE, RENAME TABLE,
                                                    <br>TRUNCATE TABLE, as consistent snapshot is not isolated<br>from them. Option automatically turns off --lock-tables."></i>
                                        </div>
                                        <div class="col-md-3 form-check form-switch">

                                            <label class="form-check-label">Quick Mode<input class="form-check-input"
                                                    type="checkbox" v-model="quick"></label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div id="pane-remote-backup" class="tab-pane fade " role="tabpanel" aria-labelledby="tab-local-backup"
                    tabindex="0">
                    <div class="alert alert-info" role="alert">
                        Please configure the SSH key login for the remote server in advance.
                    </div>
                    <form id="remote-backup-form">
                        <div class="card mb-3">
                            <div class="card-header">
                                Essential Parameters
                            </div>
                            <div class="card-body">
                                <div class="row g-2">
                                    <div class="col-md-4 form-check  form-switch">
                                        <label class="form-check-label">Enable Remote Backup
                                            <input class="form-check-input" type="checkbox"
                                                v-model="enableRemoteBackup">
                                        </label>

                                    </div>
                                </div>
                                <div class="row g-2 mt-2">
                                    <div class="col-md-4">
                                        <label class="form-label">Remote Host
                                            <input type="text" class="form-control" v-model="remote_host">
                                        </label>
                                    </div>
                                    <div class=" col-md-4">
                                        <label class="form-label">Remote User
                                            <input type="text" class="form-control" v-model="remote_user"></label>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label">Remote Directory
                                            <input type="text" class="form-control" v-model="remote_dir">
                                        </label>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div id="pane-schedule" class="tab-pane fade" role="tabpanel" aria-labelledby="tab-schedule"
                    tabindex="0">
                    <form id="schedule-form">
                        <div class="card mb-3">
                            <div class="card-header">
                                Schedule Settings
                            </div>
                            <div class="card-body">
                                <div class="row g-2">
                                    <div class="col-md-4 form-check  form-switch">
                                        <label class="form-check-label">Enable Schedule
                                            <input class="form-check-input" type="checkbox" v-model="enableSchedule">
                                        </label>
                                    </div>
                                </div>
                                <div class="row g-2 mt-2">
                                    <div class="col-md-4">
                                        <label class="form-label">Minute
                                            <select class="form-select" v-model="schedule_minute">
                                                <option value="*" selected>Every Minute (*)</option>
                                                <option :value="n-1" v-for="n in 60">{{n-1}}</option>
                                            </select>
                                        </label>
                                    </div>
                                    <div class=" col-md-4">
                                        <label class="form-label">Hour
                                            <select class="form-select" v-model="schedule_hour">
                                                <option value="*" selected>Every Hour (*)</option>
                                                <option :value="n-1" v-for="n in 60">{{n-1}}</option>
                                            </select>
                                        </label>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label">Day
                                            <select class="form-select" v-model="schedule_day">
                                                <option value="*" selected>Every Day (*)</option>
                                                <option :value="n-1" v-for="n in 31">{{n-1}}</option>
                                            </select>
                                        </label>
                                    </div>

                                </div>
                                <div class="row g-2 mt-2">
                                    <div class="col-md-4">
                                        <label class="form-label">Month
                                            <select class="form-select" v-model="schedule_month">
                                                <option value="*" selected>Every Month (*)</option>
                                                <option
                                                    v-for="(month, index) in ['January', 'February', 'March', 'April', 'May', 'June','July', 'August', 'September', 'October', 'November', 'December']"
                                                    :key="index" :value="index + 1">
                                                    {{ month }}
                                                </option>
                                            </select>
                                    </div>
                                    <div class=" col-md-4">
                                        <label class="form-label">Weekday
                                            <select class="form-select" v-model="schedule_weekday">
                                                <option value="*" selected>Every Day (*)</option>
                                                <option
                                                    v-for="(day, index) in ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday']"
                                                    :key="index" :value="index">
                                                    {{ day }}
                                                </option>
                                            </select>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card mb-3">
                            <div class="card-header">
                                Auto Clear Settings
                            </div>
                            <div class="card-body">
                                <div class="row g-2">
                                    <div class="col-md-4 ">
                                        <label class="form-label">Keep Days
                                            <select class="form-select" v-model="keep_days">
                                                <option value="0" selected>Keep all backups</option>
                                                <option value="3" selected>Keep 3 days</option>
                                                <option value="7" selected>Keep a week</option>
                                                <option value="14" selected>Keep two weeks</option>
                                                <option value="21" selected>Keep three weeks</option>
                                                <option value="30" selected>Keep a month</option>
                                                <option value="60" selected>Keep two months</option>
                                            </select>
                                        </label>
                                    </div>
                                    <div class="col-md-4 form-check form-switch mt-4">
                                        <label class="form-check-label">Keep a monthly backup
                                            <input class="form-check-input" type="checkbox" v-model="keep_month">
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div id="pane-notification" class="tab-pane fade" role="tabpanel" aria-labelledby="tab-notification"
                    tabindex="0">
                    <form id="notify-form">
                        <div class="card mb-3">
                            <div class="card-header">
                                Essential Parameters
                            </div>
                            <div class="card-body">
                                <div class="row g-2">
                                    <div class="col-md-4 form-check  form-switch">
                                        <label class="form-check-label">Enable Notification
                                            <input class="form-check-input" type="checkbox"
                                                v-model="enableNotification">
                                        </label>
                                    </div>
                                </div>
                                <div class="row g-2 mt-2">
                                    <div class="col-md-4">
                                        <label class="form-label">Config file path
                                            <input type="text" class="form-control" v-model="confFilePath" required>
                                        </label>
                                    </div>
                                    <div class="alert alert-info mt-2" role="alert">
                                        Create the <code>{{confFilePath}}</code> file with the following contents and
                                        modify it as needed.
                                        <pre class="bg-light p-3 border rounded">{{notifyConfExample}}</pre>
                                    </div>
                                </div>
                                <div class="row g-2 mt-2">
                                    <div class="col-md-3">
                                        <label class="form-label">Smtp Host</label>
                                        <input type="text" class="form-control" v-model="smtp_host">

                                    </div>
                                    <div class=" col-md-3">
                                        <label class="form-label">Smtp Port</label>
                                        <input type="text" class="form-control" v-model="smtp_port">
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">Mail From</label>
                                        <input type="text" class="form-control" v-model="smtp_mail_from">

                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">Mail to</label>
                                        <input type="text" class="form-control" v-model="smtp_mail_to">

                                    </div>
                                </div>
                                <div class="row g-2 mt-2">
                                    <div class="col-md-6">
                                        <label class="form-label">Mail Subject</label>
                                        <input type="text" class="form-control" v-model="smtp_mail_subject">

                                    </div>
                                    <div class=" col-md-6">
                                        <label class="form-label">Smtp Body</label>
                                        <input type="text" class="form-control" v-model="smtp_mail_body">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>


            <!-- Display the Generated Command -->
            <div class="mt-4">
                <h5>Generated Command</h5>
                <pre id="generatedCommand" class="bg-light p-3 border rounded">{{commandText}}</pre>
            </div>


            <button type="button" class="btn btn-primary" @click="copyToClipboard">Copy Command</button>
            <div v-cloak v-if="showAlert" :class="[alertClass]" class="alert mt-2" role="alert">{{alertMessage}}
            </div>
        </div>

    </div>
    <hr>
    <p class="text-center">Â© 2024 onlytiancai@gmail.com</p>

    <script src="static/lib/bootstrap-5.3.3/bootstrap.bundle.min.js"></script>
    <script src="static/lib/use-bootstrap-tag/use-bootstrap-tag.min.js"></script>
    <script type="module">
        import { createApp, ref, computed, useTemplateRef, onMounted, watchEffect } from './static/lib/vue.esm-browser.js'

        createApp({
            setup() {
                const useEnv = ref(true)
                const confFilePath = ref('./mysql_backup.cnf')
                const dbConfExample = ref('[client]\nuser=your_username\npassword=your_password\nhost=127.0.0.1\nport=3306')
                const host = ref('')
                const user = ref('')
                const password = ref('')
                const allDatabases = ref(false)
                const database = ref('mytest2')
                const tables = ref('')
                const outputFile = ref('./data')
                const port = ref(3306)
                const addDropDatabase = ref(false)
                const skipAddDropTable = ref(true)
                const otherArgs = ref('')
                const routines = ref(false)
                const triggers = ref(false)
                const noData = ref(false)
                const singleTransaction = ref(true)
                const quick = ref(false)
                const lockTables = ref(false)
                const compress = ref(0)
                const showAlert = ref(false);
                const form = useTemplateRef('form')
                const tablesEle = useTemplateRef('tables')
                const alertClass = ref('alert-success')
                const alertMessage = ref('')
                const masterData = ref(2)
                let tablesInput = null;


                const enableRemoteBackup = ref(false)
                const remote_user = ref('ubuntu')
                const remote_host = ref('bak-server')
                const remote_dir = ref('/data/backup/')

                const enableSchedule = ref(false)
                const schedule_minute = ref('0')
                const schedule_hour = ref('0')
                const schedule_day = ref('*')
                const schedule_month = ref('*')
                const schedule_weekday = ref('*')
                const basePath = ref('.')
                const keep_days = ref(0)
                const keep_month = ref(false)

                const enableNotification = ref(false)
                const notifyConfExample = ref('[smtp]\nuser=your_username\npassword=your_password')
                const smtp_host = ref('smtp.qq.com')
                const smtp_port = ref(587)
                const smtp_mail_from = ref('wawasoft@qq.com')
                const smtp_mail_to = ref('hao@ihuhao.com')
                const smtp_mail_subject = ref('MySQL data backup notification')
                const smtp_mail_body = ref('MySQL data backup notification')

                watchEffect(() => {
                    if (tablesEle.value) {
                        tablesInput = UseBootstrapTag(tablesEle.value)
                        if (tables.value) tablesInput.addValue(tables.value.split(' '))
                    }
                })
                onMounted(() => {
                    const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
                    const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))

                    const popoverTriggerList = document.querySelectorAll('[data-bs-toggle="popover"]')
                    const popoverList = [...popoverTriggerList].map(popoverTriggerEl => new bootstrap.Popover(popoverTriggerEl))
                })


                const commandText = computed(() => {
                    const inShell = enableRemoteBackup.value || enableSchedule.value || enableNotification.value
                    let command = ''

                    const fileName = inShell ? 'db_bak_\\`date +%Y%m%d%H%M%S\\`.sql' : 'mysql_bak_`date +%Y%m%d%H%M%S`.sql' 
                    let fileDir = outputFile.value;
                    if (!fileDir) fileDir = './'
                    if (!fileDir.endsWith('/')) fileDir += '/'
                    const filePath = `${fileDir}${fileName}`

                    if (inShell) {
                        command += `cat <<EOF > ./mysql_backup.sh\n#!/bin/bash\nset -euo pipefail\n\n`
                        command += `FILE=${filePath}\n`
                    }

                    command += 'mysqldump'
                    if (useEnv.value) {
                        command += ` --defaults-extra-file=${confFilePath.value}`
                    } else {
                        if (host.value) command += ` -h ${host.value}`;
                        if (user.value) command += ` -u ${user.value}`;
                        if (password.value) command += ` -p${password.value}`;
                        if (port.value != 3306) command += ` --port=${port.value}`;
                    }

                    if (allDatabases.value) {
                        command += ` --all-databases`;

                    } else {
                        if (database.value) command += ` ${database.value}`;
                        if (tables.value) command += ` ${tables.value}`
                    }
                    if (addDropDatabase.value) command += ` --add-drop-database`;
                    if (skipAddDropTable.value) command += ` --skip-add-drop-table`;
                    if (otherArgs.value) command += ` ${otherArgs.value} `;
                    if (routines.value) command += ` --routines`;
                    if (triggers.value) command += ` --triggers`;

                    if (noData.value) command += ` --no-data`;
                    if (singleTransaction.value) command += ` --single-transaction`;
                    if (quick.value) command += ` --quick`;
                    if (lockTables.value) command += ` --lock-tables`;
                    if (compress.value) command += ` --compress=${compress.value}`;
                    if (masterData.value != 0) command += ` --source-data=${masterData.value}`;


                    if (inShell) {
                        command += ' > \\$FILE'
                    } else {
                        command += ` > ${filePath}`
                    }


                    if (inShell) {
                        if (keep_days.value > 0) {
                            command += `\nfind ${fileDir} -name "db_bak_*.sql" -type f -mtime +${keep_days.value} `
                            
                            if (keep_month.value) {
                                command += " ! -name 'db_bak_??????01??????.sql' "
                            }                           

                            command += `-print -exec rm -f {} \;`                           
                        }
                        if (enableRemoteBackup.value) {
                            command += `\nrsync -avzP \\$FILE ${remote_user.value}@${remote_host.value}:${remote_dir.value}`
                        }
                        if (enableNotification.value) {
                            command += `
if [ $? -eq 0 ]; then
    STATUS="Backup successful"
else
    STATUS="Backup failed"
fi

python3 <<PYCODE
import smtplib
from email.mime.text import MIMEText
from configparser import ConfigParser
conf = ConfigParser()
conf.read('${confFilePath.value}')

msg = MIMEText('[\\$STATUS]${smtp_mail_body.value}')
msg['Subject'] = '[\\$STATUS]${smtp_mail_subject.value}'
msg['From'] = '${smtp_mail_from.value}'
msg['To'] = '${smtp_mail_to.value}'

with smtplib.SMTP('${smtp_host.value}', ${smtp_port.value}) as server:
    server.starttls()
    server.login(conf['smtp']['user'], conf['smtp']['password'])
    server.send_message(msg)
PYCODE                            
                            `
                        }
                        command += '\nEOF\n'
                        command += 'chmod +x ./mysql_backup.sh'
                    }

                    if (enableSchedule.value) {
                        command += '\ncrontab -l > crontab_backup_$(date +\'%Y%m%d_%H%M%S\').txt 2>/dev/null\n'
                        command += `new_rule="${schedule_minute.value} ${schedule_hour.value} ${schedule_day.value} ${schedule_month.value} ${schedule_weekday.value} cd $PWD && ./mysql_backup.sh >>./mysql_backup.log 2>&1 &"\n`;
                        command += '(crontab -l 2>/dev/null; echo "$new_rule") | crontab -'
                    }
                    return command;
                })

                function showInfo(message, cssClass = 'alert-success') {
                    showAlert.value = true
                    alertClass.value = cssClass
                    alertMessage.value = message
                    setTimeout(() => showAlert.value = false, 2000);
                }
                function copyToClipboard() {
                    form.value.classList.add('was-validated')
                    if (!form.value.checkValidity()) {
                        showInfo('please check your input!', 'alert-warning')
                        return;
                    }

                    navigator.clipboard.writeText(commandText.value).then(() => {
                        showInfo('Content copied to clipboard!')
                    }).catch(err => {
                        showInfo('Failed to copy content: ' + err, 'alert-warning')
                    });
                }

                function tableChange(params) {
                    if (tablesInput) {
                        tables.value = tablesInput.getValues().join(' ')
                    }
                }

                return {
                    useEnv, host, user, password, database, outputFile, port, addDropDatabase, skipAddDropTable, otherArgs,
                    routines, triggers, noData, singleTransaction, quick, lockTables, compress, commandText,
                    copyToClipboard, showAlert, alertMessage, alertClass, masterData, tableChange,
                    enableRemoteBackup, remote_user, remote_host, remote_dir, allDatabases, confFilePath, dbConfExample,
                    enableSchedule, schedule_minute, schedule_hour, schedule_day, schedule_month, schedule_weekday, keep_days, keep_month,
                    enableNotification, notifyConfExample, smtp_host, smtp_port, smtp_mail_from, smtp_mail_to, smtp_mail_subject, smtp_mail_body,
                }

            }
        }).mount('#app')
    </script>

</body>

</html>